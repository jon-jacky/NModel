<div class="wikidoc"><b>Composition</b> combines two or more separate <a href="https://nmodel.codeplex.com/wikipage?title=Model%20Programs&referringTitle=Composition">model programs</a> into a new model program called the <i>product</i>.   Compose a contract model program with a scenario to achieve scenario control for testing, or to check a temporal property during analysis. Compose two or more contract model programs to build up complex models in a well-structured way.<br /><br />The NModel tools <a href="https://nmodel.codeplex.com/wikipage?title=Model%20Program%20Viewer&referringTitle=Composition">mpv</a>, <a href="https://nmodel.codeplex.com/wikipage?title=Offline%20Test%20Generator&referringTitle=Composition">otg</a>, and <a href="https://nmodel.codeplex.com/wikipage?title=Conformance%20Tester&referringTitle=Composition">ct</a>, compose all of the model programs entered as options on the command line.  Any combination of C# model programs and finite state machines (FSMs) can be composed.   <br /><br />Composition synchronizes on shared actions and interleaves unshared actions. Here is an example.  Consider the C# model program on <a href="https://nmodel.codeplex.com/wikipage?title=Model%20Programs&referringTitle=Composition">this page</a>, compiled in <span class="codeInline">PowerSwitch.dll</span>.   This program can be visualized alone by <span class="codeInline"> mpv /r:PowerSwitch.dll PowerSwitch.Contract.Create</span>.<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=NModel&DownloadId=33496" alt="PowerSwitch.png" title="PowerSwitch.png" /><br /><br />Let us compose this program with the following finite state machine (FSM), in a file called <span class="codeInline">SpeedControl.txt</span>:<br /><br /><pre>
FSM(Low(), AcceptingStates(Low()), 
  Transitions(t(Low(), IncrementSpeed(), Medium()),   
              t(Medium(), IncrementSpeed(), High()), 
              t(High(), IncrementSpeed(), Low())))
</pre><br />You can view this FSM alone, by <span class="codeInline"> mpv /fsm:SpeedControl.txt</span>:<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=NModel&DownloadId=33497" alt="SpeedControl.png" title="SpeedControl.png" /><br /><br />To compose these two programs, use<br /><span class="codeInline"> mpv /r:PowerSwitch.dll /fsm:SpeedControl.txt PowerSwitch.Contract.Create</span><br /> <br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=NModel&DownloadId=33495" alt="PowerAndSpeed.png" title="PowerAndSpeed.png" /><br /><br />Here there are no shared actions, so all the unshared actions interleave, and the product is larger (has more states and transitions) than the programs that were composed.    When actions are shared, the product is smaller; the set of traces of the product is the intersection of the sets of traces of the composed programs.  In that case, composition has the effect of selecting some runs of interest, so it is useful for scenario control and property checking.<br /><br />Composition of model programs is a generalization of the construction of finite automata for the intersection of regular languages.  For example, see the discussion following Theorem 3.3 on pp. 59 -- 60 of Hopcroft and Ullman, 1979 edition.<br /></div><div class="ClearBoth"></div>