<div class="wikidoc"><h3>Model Program Viewer</h3><a href="#Usage">Usage</a> <a href="#Examples">Examples</a> <a href="#Options">Options</a> <a href="#FileMenu">FileMenu</a> <a href="#Toolbar">Toolbar</a> <a href="#Selections">Selections</a> <a href="#ContextMenu">ContextMenu</a><br /><br />Use <span class="codeInline">mpv</span> to visualize and analyze the behavior of one or more model programs.  For example, visualize the model program from <a href="https://nmodel.codeplex.com/wikipage?title=Model%20Programs&referringTitle=Model%20Program%20Viewer">this page</a> by <span class="codeInline"> mpv /r:PowerSwitch.dll PowerSwitch.Contract.Create</span>.<br /><br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=NModel&DownloadId=33498" alt="PowerSwitch.png" title="PowerSwitch.png" /><br /><br />The <span class="codeInline">mpv</span> tool performs <i>exploration</i>, which generates a <i>finite state machine</i> (FSM) from a (possibly &quot;infinite&#39;&#39;) model program.   The tool displays the graph of the generated FSM.  The tool explores and displays the <a href="https://nmodel.codeplex.com/wikipage?title=Composition&referringTitle=Model%20Program%20Viewer">composition</a> of all the model programs named on its command line, which can be C# model programs or FSMs.  The tool provides many options (on the command line and in its GUI) for adjusting the appearance of the displayed graph, and for saving and restoring the results of exploration.  It also provides facilities for inspecting the states (program variables and their values), and for exploring programs interactively (incrementally, working forward from some state of interest).<br /><br />By searching the FSM, <span class="codeInline">mpv</span> can perform <i>safety analysis</i> that checks whether the system can reach forbidden (unsafe) states, and <i>liveness</i> analysis that identifies <i>dead states</i> from which goals cannot be reached.  The <span class="codeInline">mpv</span> tool can also check temporal properties expressed as FSMs by using composition.<br /><br />In order to run <span class="codeInline">mpv</span>, you must also install the graph layout engine GLEE. Notice that GLEE uses a less permissive license than NModel.  Alternatively to <span class="codeInline">mpv</span> (or in addition to it), you may use <a href="https://nmodel.codeplex.com/wikipage?title=Model%20Program%20to%20Dot&referringTitle=Model%20Program%20Viewer">mp2dot</a> (Model Program to Dot). The <span class="codeInline">mp2dot</span> program does not require GLEE, and is covered by the more permissive NModel license.<br /><a name="Usage"></a>
<h3>Usage</h3>
<pre>
mpv [/reference:&lt;string&gt;]* [/mp:&lt;string&gt;]* [/initialTransitions:&lt;int&gt;]* 
[/transitionLabels:{None|ActionSymbol|Action}]* [/nodeLabelsVisible[+|-]]* 
[/initialStateColor:&lt;string&gt;]* [/hoverColor:&lt;string&gt;]* 
[/selectionColor:&lt;string&gt;]* [/deadStateColor:&lt;string&gt;]* [/deadStatesVisible[+|-]]* 
[/unsafeStateColor:&lt;string&gt;]* [/maxTransitions:&lt;int&gt;]* [/loopsVisible[+|-]]* 
[/mergeLabels[+|-]]* [/acceptingStatesMarked[+|-]]* 
[/stateShape:{Box|Circle|Diamond|Ellipse|Octagon|Plaintext}]* 
[/direction:{TopToBottom|LeftToRight|RightToLeft|BottomToTop}]* 
[/combineActions[+|-]]* [/livenessCheckIsOn[+|-]]* [/safetyCheckIsOn[+|-]]* 
[/testSuite:&lt;string&gt;]* [/fsm:&lt;string&gt;]* [/startTestAction:&lt;string&gt;]*
[/group:&lt;string&gt;]*
&lt;model&gt;* @&lt;file&gt;
</pre><br /><a name="Examples"></a>
<h3>Examples</h3>
<pre>
mpv @mpv_args.txt
mpv /fsm:M1.txt /fsm:M2.txt
mpv /testSuite:ContractTest.txt
mpv /r:NewsReaderUI.dll NewsReader.Factory.Create
mpv /r:NewsReaderUI.dll /mp:NewsReader
mpv /r:Controller.dll Reactive.Factory.Create /safetyCheckIsOn+
mpv /r:Controller.dll /mp:Reactive /safetyCheckIsOn+
</pre><br /><a name="Options"></a>
<h3>Options</h3>
<br /><span class="codeInline">/?, /help</span><br />Displays usage information and exits.<br /><br /><span class="codeInline">[/reference:&lt;string&gt;]*</span><br />Referenced assemblies. (Short form: <span class="codeInline">/r</span>)<br /><br /><span class="codeInline">[/mp:&lt;string&gt;]*</span> <br />Model programs given in the form <span class="codeInline">M</span> or <span class="codeInline">M[F1,...,Fn]</span> where <span class="codeInline">M</span> is a model program name (namespace) and each <span class="codeInline">Fi</span> is a feature in <span class="codeInline">M</span>.  Multiple model programs are composed into a product.  No factory method is needed if this option is used.<br /><br /><span class="codeInline">[/initialTransitions:&lt;int&gt;]*</span><br />Number of transitions that are explored initially up to <span class="codeInline">maxTransitions</span>.  Negative value implies no bound. Default value: &#39;-1&#39;<br /><br /><span class="codeInline">[/transitionLabels:{None|ActionSymbol|Action}]*</span><br />Determines what is shown as a transition label. Default value: &#39;Action&#39;<br /><br /><span class="codeInline">[/nodeLabelsVisible[+|-]]*</span><br />Visibility of node labels.  Default value:  <span class="codeInline">&#39;+&#39;</span><br /><br /><span class="codeInline">[/initialStateColor:&lt;string&gt;]*</span><br />Background color of the initial state.  Default value: &#39;LightGray&#39;<br /><br /><span class="codeInline">[/hoverColor:&lt;string&gt;]*</span><br />Line and action label color to use when edges or nodes are hovered over.  Default value: &#39;Lime&#39;<br /><br /><span class="codeInline">[/selectionColor:&lt;string&gt;]*</span><br />Background color to use when a node is selected.  Default value: &#39;Blue&#39;<br /><br /><span class="codeInline">[/deadStateColor:&lt;string&gt;]*</span><br />Background color of dead states. Dead states are states from which no accepting state is reachable.  Default value: &#39;Yellow&#39;<br /><br /><span class="codeInline">[/deadStatesVisible[+|-]]*</span><br />Visibility of dead states.  Default value:  <span class="codeInline">&#39;+&#39;</span><br /><br /><span class="codeInline">[/unsafeStateColor:&lt;string&gt;]*</span><br />Background color of states that violate a safety condition (state invariant).  Default value: &#39;Red&#39;<br /><br /><span class="codeInline">[/maxTransitions:&lt;int&gt;]*</span><br />Maximum number of transitions to draw in the graph. Default value: &#39;100&#39;<br /><br /><span class="codeInline">[/loopsVisible[+|-]]*</span><br />Visibility of transitions whose start and end states are the same. Default value:  <span class="codeInline">&#39;+&#39;</span><br /><br /><span class="codeInline">[/mergeLabels[+|-]]*</span><br />Multiple transitions between same start and end states are shown as one transition with a merged label. Default value: <span class="codeInline">&#39;+&#39;</span><br /><br /><span class="codeInline">[/acceptingStatesMarked[+|-]]*</span><br />Mark accepting states with a bold outline.  Default value: <span class="codeInline">&#39;+&#39;</span><br /><br /><span class="codeInline">[/stateShape:{Box|Circle|Diamond|Ellipse|Octagon|Plaintext}]*</span><br />State shape.  Default value: &#39;Ellipse&#39;<br /><br /><span class="codeInline">[/direction:{TopToBottom|LeftToRight|RightToLeft|BottomToTop}]*</span><br />Direction of graph layout.  Default value: &#39;TopToBottom&#39;<br /><br /><span class="codeInline">[/combineActions[+|-]]*</span><br />Whether to view matching start and finish actions by a single label. Default value: &#39;-&#39;<br /><br /><span class="codeInline">[/livenessCheckIsOn[+|-]]*</span><br />Mark states from which no accepting state is reachable in the current view. Default value: &#39;-&#39;<br /><br /><span class="codeInline">[/safetyCheckIsOn[+|-]]*</span><br />Mark states that violate a safety condition (state invariant). Default value: &#39;-&#39;<br /><br /><span class="codeInline">/testSuite:&lt;string&gt;]*</span><br />File name of a file containing a sequence of actions sequences (test cases) to be viewed.<br /><br /><span class="codeInline">[/fsm:&lt;string&gt;]*</span><br />File name of a file containing the term representation <span class="codeInline">fsm.ToTerm()</span> of an <span class="codeInline">fsm</span> (object of type FSM).  Multiple FSMs are composed into a product.<br /><br /><span class="codeInline">[/group:&lt;string&gt;]*</span><br />Name of a state property to use as the abstraction function for grouping.<br /><br /><span class="codeInline">[/startTestAction:&lt;string&gt;]*</span><br />Name of start action of a test case.  This value is used only if a <span class="codeInline">testSuite</span> is provided.  Default value: &#39;Test&#39;<br /><br /><span class="codeInline">&lt;model&gt;*</span><br />Fully qualified names of factory methods returning an object that is an instance of <span class="codeInline">ModelProgram</span>.  Multiple model programs are composed into a product.  No factory method arguments are needed if the <span class="codeInline">/mp:</span> option is used instead.<br /><br /><span class="codeInline">@&lt;file&gt;</span><br />Read response file for more options.<br /><a name="FileMenu"></a>
<h3>File Menu</h3>
<span class="codeInline">Save Settings...</span><br />Saves the values of all the options (above) in a <i>response file</i> so they can be restored into another <span class="codeInline">mpv</span> session with the <span class="codeInline">@&lt;file&gt;</span> command line option. <br /><a name="Toolbar"></a>
<h3>Toolbar </h3>
The <span class="codeInline">mpv</span> tool provides several operations on a <i>toolbar</i>, a row of icons across the top of its window.  Some icons include a down arrow you can click to display a drop-down menu.  Hovering the mouse pointer over a toolbar icon displays a <i>tooltip</i>, text that identifies its function.  Here are descriptions of the toolbar operations, each labeled by its tooltip.<br /><br /><span class="codeInline">(Model program name)</span> <br />The name of the model program whose FSM is currently displayed.  <i>M[F1,F2]</i> indicates model program <i>M</i> with features <i>F1</i> and <i>F2</i> included. <i>M1 x M2</i> indicates the product of <i>M1</i> and <i>M2</i> formed by <a href="https://nmodel.codeplex.com/wikipage?title=Composition&referringTitle=Model%20Program%20Viewer">composition</a>.  Selecting <i>M1</i> or <i>M2</i> from the drop down menu displays the FSM of that program projected onto the product.<br /><br /><span class="codeInline">Zoom In</span><br />Enlarge the displayed FSM within the window.  Use the scroll bars at bottom and right to pan the enlarged graph, or use <span class="codeInline">Pan</span> (below).  You can also enlarge the entire window by dragging on its sides or corners; the graph will enlarge to fit.<br /><br /><span class="codeInline">Save as image...</span><br />Save the displayed FSM in a file.  From the drop-down menu, <span class="codeInline">Save as Image...</span> saves an image in JPG format, <span class="codeInline">Save as Dot...</span> saves a text file in the <i>dot</i> language used by <i>Graphviz</i>, and <span class="codeInline">Save as FSM...</span> saves a text file in the term representation used by NModel, that can be restored into another <span class="codeInline">mpv</span> session with the <span class="codeInline">/fsm:&lt;file&gt;</span> command line option. <br /><br /><span class="codeInline">Zoom Out</span><br />Reduce the displayed FSM within the window.<br /><br /><span class="codeInline">Pan</span><br />Drag enlarged FSM in window, by holding down left mouse button while moving mouse.  Alternative to scroll bars.<br /><br /><span class="codeInline">Print</span><br />Print the FSM, opens Print dialog.<br /><br /><span class="codeInline">Merge Labels</span><br />Toggles the <span class="codeInline">mergeLabels</span> option.  When the option is <span class="codeInline">&#39;+&#39;</span>, <i>True</i>, the graph appears less cluttered.<br /><br /><span class="codeInline">Show Self-Loops</span><br />Toggles the <span class="codeInline">loopsVisible</span> option.  When the option is &#39;-&#39;, <i>False</i>, the graph appears less cluttered.<br /><br /><span class="codeInline">Transition Labels</span> <br />Cycles through the <span class="codeInline">transitionLabels</span> options: <span class="codeInline">Action</span> (most verbose), <span class="codeInline">ActionSymbol</span> (less verbose), <span class="codeInline">None</span>.  The <span class="codeInline">Action</span> can always be displayed by hovering the mouse over a transition arc in the graph. <br /><br /><span class="codeInline">Combine Start and Finish Actions</span><br />Toggles the <span class="codeInline">combineActions</span> option.  When the option is &#39;+&#39;,  <i>True</i>, the graph appears less cluttered.<br /><br /><span class="codeInline">Layout Direction</span><br />The drop-down menu offers the <span class="codeInline">direction</span> options: <span class="codeInline">TopToBottom</span>, <span class="codeInline">LeftToRight</span>, <span class="codeInline">RightToLeft</span>, <span class="codeInline">BottomToTop</span>.<br /><br /><span class="codeInline">State Viewer</span><br />Displays (or hides) the state viewer in a panel on the right side of the window. The state viewer shows the state variables and their values in the state that is selected by left-clicking in the displayed graph.  The state can always be displayed by hovering the mouse over a state bubble in the graph.<br /><br /><span class="codeInline">Advanced Properties </span><br />Displays (or hides) the display of all the option values in a panel on the right side of the window.  You can toggle/cycle/edit the option values in the panel. This panel also shows <i>Exploration statistics</i>: the number of <i>States</i>, <i>Transitions</i>, <i>Accepting States</i>, <i>Unsafe States</i>, and <i>Dead States</i>, so you do not need to search the graph by eye.<br /><a name="Selections"></a>
<h3>Selections and highlighting</h3>
Hovering the mouse over a state bubble highlights that state and shows the state variables and their values.  Hovering the mouse over a transition arc highlights the arc displays its action (the action method invocation, and its return value if there is one).<br /><br />Left clicking on a state bubble selects that state.  The selected state is indicated by the <span class="codeInline">SelectionColor</span>. The state variables and their values in the selected state appear in the State Viewer panel, if it has been toggled on.  Context menu items and keyboard shortcuts apply to the selected state.<br /><a name="ContextMenu"></a>
<h3>Context menu and keyboard shortcuts </h3>
Right-clicking on a state bubble selects that state and displays a context menu with these entries: <br /><br /><span class="codeInline">Show Outgoing (Enter)</span> <br /><span class="codeInline">Hide Outgoing (Backspace)</span> <br /><span class="codeInline">Show Reachable (Insert)</span><br /><span class="codeInline">Hide Reachable (Delete)</span><br /><span class="codeInline">Select Next (n)</span><br /><span class="codeInline">Select Previous (p)</span><br /><br />To explore interactively, select the initial state, press the <i>Delete</i> key to hide all the transitions and other states, press the <i>Enter</i> key to show the transitions enabled in the initial state, press the <i>n</i> or <i>p</i> keys to select another state, and so on.</div><div class="ClearBoth"></div>